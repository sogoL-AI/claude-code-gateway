# T06: 数据源扫描分析

## 问题描述

这是整个分析系统的基础任务，需要全面扫描Claude CLI的数据目录，了解数据规模和基本特征：

1. **数据发现**: 扫描 `~/.claude/` 目录下的所有Session和Todos文件
2. **基础统计**: 文件数量、大小、记录数等基本指标
3. **项目分类**: 按项目目录组织Session文件
4. **时间范围**: 确定数据的时间跨度和分布

## 技术挑战

- **目录遍历**: 递归扫描复杂的目录结构
- **文件解析**: 快速读取JSONL文件的基本信息而不完全加载
- **元数据提取**: 从文件路径和内容中提取Session ID、项目名等
- **性能优化**: 快速扫描数百个文件的基本信息

## 预期结果

### 输出文件
- `scan_results.json` - 完整的数据源扫描报告

### 关键指标
- **文件统计**: Session文件数量、Todos文件数量
- **数据规模**: 总记录数、总文件大小(MB)
- **项目分布**: 涉及的项目数量和名称列表
- **时间范围**: 最早和最新的数据时间戳

### 实际成果
根据最新执行结果：
- ✅ 总文件数: 468个
- ✅ 总记录数: 30,365条
- ✅ 总大小: 118.54 MB
- ✅ 项目数量: 21个不同项目
- ✅ Session文件: 208个
- ✅ Todos文件: 260个
- ✅ 时间范围: 2025-07-28 至 2025-08-02

## 扫描内容

### 文件类型识别
- **Session文件**: `.jsonl` 格式，包含对话记录
- **Todos文件**: `.json` 格式，包含任务列表

### 元数据提取
- **Session ID**: 从文件名中提取UUID格式的Session标识符
- **项目名**: 从文件路径中提取项目目录名
- **文件大小**: 字节级精确文件大小
- **记录计数**: JSONL文件的行数统计
- **修改时间**: 文件最后修改时间戳

### 项目分类示例
```
-Users-Zhuanz-Projects-claude-code-gateway
-Users-Zhuanz-Projects-Arche
-Users-Zhuanz-Projects-nx-project
todos
...
```

## 使用方式

```bash
# 单独执行
python tasks/T06_data_source_scanning/data_scanner.py outputs/T06_data_scan

# 通过调度器执行 (基础任务，无依赖)
python task_scheduler.py --tasks T06
```

## 依赖关系

- **输入依赖**: 无 (基础任务)
- **输出用途**: 所有其他任务 (T01-T05, T07-T08) 的基础数据源

## 应用价值

- **数据概览**: 为整个分析系统提供数据基线
- **容量规划**: 了解数据规模，制定处理策略
- **项目发现**: 识别所有相关项目和数据来源
- **依赖基础**: 为后续所有分析任务提供文件清单

## 技术实现

- **算法**: 目录遍历 + 文件信息提取 + JSON解析
- **数据结构**: 文件清单 + 统计汇总 + 项目分组
- **性能**: 扫描468个文件 < 1秒，内存占用最小

## 输出结构示例

```json
{
  "task_id": "T06",
  "scan_summary": {
    "total_files": 468,
    "total_records": 30365,
    "total_size_mb": 118.54,
    "projects_count": 21,
    "session_files": 208,
    "todos_files": 260
  },
  "projects": ["project1", "project2", ...],
  "date_range": {
    "start": "2025-07-28T15:20:06",
    "end": "2025-08-02T00:00:20"
  },
  "file_details": [...]
}
```